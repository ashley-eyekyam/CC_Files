{"name":"PDF to Embedding and Send Back","nodes":[{"parameters":{"path":"upload-pdf","responseMode":"onReceived","options":{"responseData":"firstEntryJson"}},"id":"Webhook_1","name":"Receive PDF","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[300,100]},{"parameters":{"direction":"binaryToJson","propertyName":"data"},"id":"MoveBinary","name":"Convert PDF to Base64","type":"n8n-nodes-base.moveBinaryData","typeVersion":1,"position":[500,100]},{"parameters":{"functionCode":"\nimport fitz\nimport base64\n\npdf_base64 = item['json']['data']\npdf_bytes = base64.b64decode(pdf_base64)\n\ndoc = fitz.open(stream=pdf_bytes, filetype='pdf')\ntext = \"\"\nfor page in doc:\n    text += page.get_text()\n\nreturn [{ \"json\": { \"text\": text } }]\n"},"id":"PythonExtract","name":"Extract Text","type":"n8n-nodes-base.python","typeVersion":1,"position":[700,100]},{"parameters":{"functionCode":"\nconst text = $json[\"text\"];\nconst chunks = text.match(/.{1,1000}/g) || [];\n\nreturn chunks.map(chunk => ({\n  json: { chunk }\n}));\n"},"id":"ChunkText","name":"Chunk Text","type":"n8n-nodes-base.function","typeVersion":1,"position":[900,100]},{"parameters":{"authentication":"predefinedCredentialType","url":"https://api.openai.com/v1/embeddings","method":"POST","responseFormat":"json","jsonParameters":true,"options":{},"headers":[{"name":"Authorization","value":"Bearer YOUR_OPENAI_API_KEY"},{"name":"Content-Type","value":"application/json"}],"bodyParametersJson":"\n{\n  \"model\": \"text-embedding-3-large\",\n  \"input\": \"={{$json.chunk}}\"\n}\n"},"id":"OpenAIEmbedding","name":"Generate Embedding","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[1100,100],"credentials":{"httpBasicAuth":{"id":"openai-credential-id","name":"OpenAI HTTP Auth"}}},{"parameters":{"functionCode":"\nreturn $input.all().map(item => ({\n  json: {\n    text: item.json.chunk,\n    embedding: item.json.data[0].embedding\n  }\n}));\n"},"id":"FormatEmbedding","name":"Format Embedding","type":"n8n-nodes-base.function","typeVersion":1,"position":[1300,100]},{"parameters":{"url":"https://your-backend.com/api/embedding/store","method":"POST","responseFormat":"json","jsonParameters":true,"options":{},"bodyParametersJson":"\n{\n  \"chunks\": {{JSON.stringify($input.all().map(i => i.json))}}\n}\n"},"id":"SendBack","name":"Send to Backend","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[1500,100]},{"parameters":{"responseData":"firstEntryJson","responseCode":200},"id":"Respond","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[1700,100]}],"connections":{"Receive PDF":{"main":[["Convert PDF to Base64"]]},"Convert PDF to Base64":{"main":[["Extract Text"]]},"Extract Text":{"main":[["Chunk Text"]]},"Chunk Text":{"main":[["Generate Embedding"]]},"Generate Embedding":{"main":[["Format Embedding"]]},"Format Embedding":{"main":[["Send to Backend"]]},"Send to Backend":{"main":[["Respond to Webhook"]]}}}
